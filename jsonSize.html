<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Size</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .json-input {
            max-width: 99%;
            height: 700px;
        }
        .json-container {
            white-space: pre-wrap;
            font-family: monospace;
            background: #282c34;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 8px;
            color: #f8f8f2;
            max-width: 98%;
            margin: 0 auto;
            outline-width: medium;
            outline-color: #e2e2e2;
            outline-style: groove;
        }
        .json-key-group {
            cursor: pointer;
            color: #ffe2e3;
            font-weight: bold;
            background: #262f40;
        }
        .json-key-group:hover {
            color: #338cff;
        }
        .json-border {
            color: #ff989f;
            font-weight: bold;
        }
        .json-key-value {
            color: #7da762;
        }
        .json-number {
            color: #96ceff;
        }
        .json-string {
            color: #7fb1d5;
        }
        .json-info-group {
            color: #777777;
        }
        .json-info-group-huge {
            color: #ff0000;
            font-weight: bold;
        }
        .json-info-group-big {
            color: #ff0000;
        }
        .json-info-group-middle {
            color: #ffde00;
        }
        .json-info-group-small {
            color: #31ad00;
        }
        .json-info-group-tiny {
            color: #4f7640;
        }
        .gone {
            display: none;
        }
        .invisible {
            color: transparent;
        }
        .json-group {
        }
        .json-collapsable {
        }
        .json-anticollapsable {
        }
        .hints {
            line-height: 6px;
            padding-left: 16px;
            padding-right: 16px;
            margin-bottom: 8px;
            background: #cccccc;
            outline-width: medium;
            outline-color: #e2e2e2;
            outline-style: groove;
        }
        .container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
        }
        button {
            padding: 10px 15px;
            margin-bottom: 20px;
            background-color: #61afef;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #4a90e2;
        }
    </style>
</head>
<body>
    <textarea id="json-input" class="json-input" placeholder="Paste your JSON here...">{
    "name": "John",
    "age": 30,
    "married": true,
    "children": [
        {
            "name": "Jane",
            "age": 10
        },
        {
            "name": "Mark",
            "age": 5
        }
    ],
    "pets": [],
    "address": {
        "street": "123 Main St",
        "city": "New York",
        "zip": {
            "num": 10001,
            "str": "10001"
        }
    }
}</textarea>
    <div class="container">
        <div>
            <button id="displayJSON-button" onclick="displayJSON()">Display JSON</button>
        </div>
        <div id="hints" class="hints">
            <p><b>Left click</b> - expand/collapse the node.</p>
            <p><b>Right click</b> - focus on this node.</p>
        </div>
    </div>
    <div id="json-display" class="json-container"></div>

    <script>
        const INDENT_SPACES = 5;
        const BUTTONS_WIDTH = 0;

        function createTreeElement(key, value, sizeOut, fullSize, level = 0, isLast = true, isParentArray = false) {
            const isGroup = typeof value === 'object' && value !== null;
            const isArray = Array.isArray(value);

            const indentSpaces = BUTTONS_WIDTH + level * INDENT_SPACES;
            const marginBegin = ' '.repeat(indentSpaces + (isGroup ? -BUTTONS_WIDTH : 0));
            const marginEnd = ' '.repeat(indentSpaces);

            const keyStr = key ? `${key}` : '';
            const delimStr = key ? `: ` : '';
            const borderStartStr = isGroup ? (isArray ? '[' : '{') : '';
            const keySize = (key && !isParentArray) ? 1/*"*/ + key.length + 1/*"*/ + 1/*:*/ : 0;
            let mySize = keySize + calculateJsonSize(value) + (isLast ? 0 : 1)/*,*/;
            sizeOut.value = mySize;

            let beforeInfo = marginBegin.length + keyStr.length + delimStr.length + borderStartStr.length;

            if (isGroup) {
                const childCount = Object.keys(value).length;
                beforeInfo += `${childCount}`.length + (isLast ? 1/*}*/ : 2/*},*/);
                const keyElement = document.createElement('span');
                const valueElement = document.createElement('div');
                const closureInlineElement = document.createElement('span');
                const closureElement = document.createElement('span');

                function appendValueChilds() {
                    const count = Object.keys(value).length;
                    let i = 0;
                    let valueChilds = [];
                    for (const k in value) {
                        let childSize = {
                            value: 0
                        };
                        const isLastChild = i === count - 1;
                        const child = createTreeElement(k, value[k], childSize, fullSize, level + 1, isLastChild, isArray)
                        valueChilds.push(pair(childSize.value, child));
                        i++;
                    }
                    valueChilds
                        .sort((a, b) => b.first - a.first)
                        .forEach((it) => {
                            valueElement.appendChild(it.second);
                        });
                }

                if (level === 0) {
                    appendValueChilds();
                }

                keyElement.onclick = () => {
                    const toExpand = valueElement.classList.contains('gone');
                    if (toExpand) {
                        if (!valueElement.hasChildNodes()) {
                            appendValueChilds();
                        }
                        valueElement.classList.remove('gone');
                        closureInlineElement.classList.add('invisible');
                        closureElement.classList.remove('gone');
                    } else {
                        valueElement.classList.add('gone');
                        closureInlineElement.classList.remove('invisible');
                        closureElement.classList.add('gone');
                    }
                };

                keyElement.oncontextmenu = () => {
                    focusThis(key, value, isLast, mySize, isParentArray);
                    return false;
                };

                beforeInfo += BUTTONS_WIDTH;
                const infoMarginSz = getInfoMarginSz(beforeInfo);
                const infoStr = formatAlignmentRight(formatBytes(mySize), infoMarginSz)
                    + ' | ' + formatPercent(mySize, fullSize)
                ;

                // ---
                const container = document.createElement('div');
                container.classList.add('json-group');

                const marginElement = document.createElement('span');
                marginElement.textContent = marginBegin
                container.appendChild(marginElement);

                keyElement.classList.add('json-key-group');
                keyElement.textContent = keyStr;
                container.appendChild(keyElement);

                const borderElement = document.createElement('span');
                borderElement.classList.add('json-border');
                borderElement.textContent = delimStr + borderStartStr;
                container.appendChild(borderElement);

                closureInlineElement.classList.add('json-border');
                closureInlineElement.classList.add('json-anticollapsable');
                closureInlineElement.textContent = childCount + (isArray ? ']' : '}') + (isLast ? '' : ',');
                container.appendChild(closureInlineElement);

                const infoElement = document.createElement('span');
                infoElement.textContent = infoStr;
                setInfoClass(infoElement, mySize, fullSize);
                container.appendChild(infoElement);

                valueElement.classList.add('json-collapsable');
                if (level !== 0) {
                    valueElement.classList.add('gone');
                    closureInlineElement.classList.remove('invisible');
                    closureElement.classList.add('gone');
                } else {
                    valueElement.classList.remove('gone');
                    closureInlineElement.classList.add('invisible');
                    closureElement.classList.remove('gone');
                }
                container.appendChild(valueElement);

                closureElement.classList.add('json-border');
                closureElement.classList.add('json-collapsable');
                closureElement.textContent = marginEnd + (isArray ? ']' : '}') + (isLast ? '' : ',');
                container.appendChild(closureElement);

                return container;
            } else {
                const valueElement = document.createElement('span');
                let valueStr;
                if (typeof value === 'string') {
                    valueElement.classList.add('json-string');
                    valueStr = `"${value}"` + (isLast ? '' : ',');
                } else {
                    valueElement.classList.add('json-number');
                    valueStr = value + (isLast ? '' : ',');
                }
                beforeInfo += valueStr.length;

                const infoMarginSz = getInfoMarginSz(beforeInfo);
                const infoStr = formatAlignmentRight(formatBytes(mySize), infoMarginSz)
                        + ' | ' + formatPercent(mySize, fullSize);

                // ---
                const container = document.createElement('div');
                container.classList.add('json-group');

                const marginElement = document.createElement('span');
                marginElement.textContent = marginBegin
                container.appendChild(marginElement);

                const keyElement = document.createElement('span');
                keyElement.classList.add('json-key-value');
                keyElement.textContent = keyStr + delimStr + borderStartStr;
                container.appendChild(keyElement);

                valueElement.textContent = valueStr;
                container.appendChild(valueElement);

                const infoElement = document.createElement('span');
                infoElement.textContent = infoStr;
                setInfoClass(infoElement, mySize, fullSize);
                container.appendChild(infoElement);

                return container;
            }
        }

        function setInfoClass(infoElement, mySize, fullSize) {
            if (mySize > fullSize / 2) {
                infoElement.classList.add('json-info-group-huge');
            } else if (mySize > fullSize / 5) {
                infoElement.classList.add('json-info-group-big');
            } else if (mySize > fullSize / 7) {
                infoElement.classList.add('json-info-group-middle');
            } else if (mySize > fullSize / 10) {
                infoElement.classList.add('json-info-group-small');
            } else {
                infoElement.classList.add('json-info-group-tiny');
            }
        }

        function getInfoMarginSz(beforeInfo, infoMod = 20) {
            const beforeInfoMod = Math.floor(beforeInfo / infoMod + 1) * infoMod;
            return beforeInfoMod - beforeInfo;
        }

        function pair(a, b){
            return { first: a, second: b };
        }

        function calculateJsonSize(jsonData) {
            const jsonString = JSON.stringify(jsonData);
            return jsonString.length;
        }

        function formatBytes(bytes) {
            if (bytes < 1024) {
                return bytes + " bytes";
            } else if (bytes < 1048576) {
                return (bytes / 1024).toFixed(2) + " KB";
            } else if (bytes < 1073741824) {
                return (bytes / 1048576).toFixed(2) + " MB";
            } else {
                return (bytes / 1073741824).toFixed(2) + " GB";
            }
        }

        function dotLine(charCount) {
            const LINE_SYMBOL = '·  ';
            // '·' U+00B7 &#183; \00B7
            // '—' U+2014 &#8212; \2014
            const len = LINE_SYMBOL.length;
            return LINE_SYMBOL.repeat(charCount / len + len).substring(0, charCount);
        }

        function formatAlignmentRight(str, extPadding) {
            const fullWidth = 16;
            const padding = Math.max(fullWidth - str.length, 0);
            return dotLine(padding + extPadding) + str;
        }

        function formatPercent(bytes, fullSize) {
            return (bytes * 100.0 / fullSize).toFixed(2) + '%';
        }

        function focusThis(key, node, isLast, fullSize, isParentArray) {
            const displayJSONButton = document.getElementById('displayJSON-button');
            displayJSONButton.innerText = "Reset";
            displayJSONButton.classList.remove('gone');

            const display = document.getElementById('json-display');
            display.innerHTML = '';
            let size = {
                value: 0
            };
            display.appendChild(createTreeElement(key, node, size, fullSize, 0, isLast, isParentArray));
        }

        function displayJSON() {
            const input = document.getElementById('json-input');
            input.classList.add('gone');
            const displayJSONButton = document.getElementById('displayJSON-button');

            let json;
            try {
                json = JSON.parse(input.value);
            } catch (e) {
                alert('Invalid JSON');
                return;
            }
            const display = document.getElementById('json-display');
            display.innerHTML = '';
            let sizeOut = {
                value: 0
            };
            display.appendChild(createTreeElement('', json, sizeOut, calculateJsonSize(json)));
            display.normalize()
            display.classList.remove('gone');
            displayJSONButton.classList.add('gone');
            document.getElementById('hints').classList.remove('gone');
        }
        document.getElementById('json-display').classList.add('gone');
        document.getElementById('hints').classList.add('gone');
    </script>
</body>
</html>
